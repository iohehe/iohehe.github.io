<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>soundiness | Penlab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="0x01 从soundness到soundiness  The typical reasons for such choices are engineering compromises: implementers of such tools are well aware of how they could handle complex language features soundly (e.g.">
<meta property="og:type" content="article">
<meta property="og:title" content="soundiness">
<meta property="og:url" content="http://example.com/2021/02/02/soundiness/index.html">
<meta property="og:site_name" content="Penlab">
<meta property="og:description" content="0x01 从soundness到soundiness  The typical reasons for such choices are engineering compromises: implementers of such tools are well aware of how they could handle complex language features soundly (e.g.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043246.png">
<meta property="og:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043248.png">
<meta property="og:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043251.png">
<meta property="og:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043313.png">
<meta property="og:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043328.png">
<meta property="og:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043335.png">
<meta property="og:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043344.png">
<meta property="article:published_time" content="2021-02-02T00:37:44.000Z">
<meta property="article:modified_time" content="2022-03-31T04:48:05.125Z">
<meta property="article:author" content="iohex">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043246.png">
  
    <link rel="alternate" href="/atom.xml" title="Penlab" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Penlab</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">The Art of Flow</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-soundiness" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/02/soundiness/" class="article-date">
  <time class="dt-published" datetime="2021-02-02T00:37:44.000Z" itemprop="datePublished">2021-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      soundiness
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="x01-从soundness到soundiness">0x01 从soundness到soundiness</h1>
<blockquote>
<p>The typical reasons for such choices are engineering compromises: implementers of such tools are well aware of how they could handle complex language features soundly (e.g., by assuming that a complex language feature can exhibit any behavior), but do not do so because this would make the analysis unscalable or imprecise to the point of being useless. Therefore, the dominant practice is one of treating soundness as an engineering choice.[1]</p>
</blockquote>
<p>目前，所有的静态分析工具都希望他们的工具能覆盖所有的情况(soundness), but现在的程序结构越来越复杂...势必有很多问题，是当前静态分析技术无法解决的(称之为Hard Language Feature)。</p>
<p>首先， 我们来看什么是soundness</p>
<blockquote>
<h2 id="soundness">Soundness</h2>
<p>Conservative approximation: the analysis captures all program behaviors, or the analysis result all possible executions of the program.</p>
</blockquote>
<p>这里的Conservative其实就是Over, 可以看到理想的soundness理论上分析处出实际程序运行时所有的路径和情形。</p>
<p>然而，无论是当前学术界和工业界都无法达到soundness。但是这些文章或技术一般都不会说自己是unsoundness的，因为通常unsoundness是故意的忽略掉分析一些行为，以达到更高效率的目的。 而这一些技术是想soundness的，但是又无法达到理想的soundness，在这种情形下，这些文章就会产生一些误导。 如一些分析工具，文章说的很好， 但是实际用起来有很多的情况cover不了导致大量误报造成结果直接不可用...</p>
<p>在想sound，sound不了。我又不是unsound的，这种情况下，就产生了soundy分析的概念。15年提出[2]的，呼吁将这一类分析结果，是soundiness的。</p>
<figure>
<img src="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043246.png" alt="truthiness" /><figcaption aria-hidden="true">truthiness</figcaption>
</figure>
<h1 id="x02-hard-language-features">0x02 hard language features</h1>
<p>几乎所有现代语言中，都有一些对于静态分析来比较hard 的点：</p>
<p><img src="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043248.png" alt="image-20210202094033999" style="zoom: 50%;" /></p>
<h2 id="java-reflection">Java Reflection</h2>
<p>以反射为例：</p>
<p><img src="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043251.png" alt="image-20210202094244020" style="zoom:20%;" /></p>
<p>反射的提出为了使得软件架构低耦合，高复用的目的。 如MVC框架中，框架要和web程序解耦，就需要通过反射去调用控制器中的方法，而不是改框架调用控制器。</p>
<p>在Java中， 反射使用的是对Class, method, field分别生成Metaobject, 然后使用这些metaobject来调用反射API接口来动态的达到静态调用效果。</p>
<p>反射是很重要的， 那么，如何静态分析呢？05年的APLAS提出了<code>String Constant analysis + Pointer Analysis</code>。</p>
<p>他们的工作， 他是通过字符串常量分析+指针分析去分析的。直观理解就是通过指针分析定位到每个metaobject的定义处，然后做字符串常量分析，去全文匹配到目标的位置。 但是问题是， 这种只能cover发射中的触发参数写在程序中的。 但是如果string value不存在， 何如？</p>
<blockquote>
<ul>
<li>Configuration files (配置文件输入)</li>
<li>Internet. (网络输入)</li>
<li>Command lines (命令行输入)</li>
<li>Complex string manipulations (复杂的字符串解析)</li>
<li>Dynamically generated (动态生成)</li>
<li>Encrypted (加密的，需要解码)</li>
</ul>
</blockquote>
<p>(插一句， 在静态安全分析中，字符串输入当作标识符真的是一大难题，感觉处理好了字符串输入，就能处理好许多静态安全问题)</p>
<p>(而我觉得目前来说，之所以大部分的漏洞都是通过手工和fuzz得到，就是因为静态分析不能cover许许多多问题)</p>
<p>这个工作的问题可以总结为： 名字不知道，啥也不知道。</p>
<p>在14年ECOOP, 南大李樾和谭添老师做了一个工作[4] (膜)，他们的方法 <code>Type Inference+String analysis+Pointer Analysis</code></p>
<p>他们的方法为：生时不可解， 用时亦可推。</p>
<p><img src="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043313.png" alt="image-20210202113047743" style="zoom:20%;" /></p>
<p>通过反射使用点，结合java强大的类型系统，去推到这个方法的线索(如有几个参数， 这些参数是什么类型)[5]。</p>
<p>目前解决这些问题还是使用动态方式比较通用，如[6]去跑java的测试用例，得到的信息供给静态分析使用， 此类工作(Assisted by Dynamic Analysis)快，准。但是soundness做的不够好。</p>
<h2 id="native-code">Native Code</h2>
<p>Native Code 是另外一种hard analysis的情况。 核心就是一种跨语言的调用，如何去静态分析。</p>
<p><img src="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043328.png" alt="image-20210202114600176" style="zoom:25%;" /></p>
<p>Java中提供了native关键字去声明调用JNI(Java Native Interface), 他是一套java调用底层平台c/c++功能的接口， 没有函数体。实现逻辑在c/c++中。这种机制能够使JVM同本地的动态链接库进行交互。</p>
<p><img src="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043335.png" alt="image-20210202114857543" style="zoom:33%;" /></p>
<p>那么这种跨语言，如何去做程序分析呢？</p>
<p>现在通常分析器通常去进行手工建模(Manually models the critical native code)...</p>
<p><img src="https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2022-03-31-043344.png" alt="image-20210202115838235" style="zoom:20%;" /></p>
<p>这里是对调用c/c++中的arraycopy进行手工建模成java逻辑， 然后转化为三地址码。</p>
<p>最近的工作[7] (ISSTA2020), 有直接在二进制上分析跨语言的调用。</p>
<h1 id="reference">reference</h1>
<p><a target="_blank" rel="noopener" href="http://soundiness.org/#Introduction">[1] http://soundiness.org/#Introduction</a></p>
<p><a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/2644805">[2] https://dl.acm.org/doi/10.1145/2644805</a></p>
<p><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/paper/Reflection-Analysis-for-Java-Livshits-Whaley/aa15b4f072b5d9f8f72b41b39c060ee5b5fb2807">[3] https://www.semanticscholar.org/paper/Reflection-Analysis-for-Java-Livshits-Whaley/aa15b4f072b5d9f8f72b41b39c060ee5b5fb2807</a></p>
<p><a target="_blank" rel="noopener" href="https://yuleisui.github.io/publications/ecoop14.pdf">[4] https://yuleisui.github.io/publications/ecoop14.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/paper/Understanding-and-Analyzing-Java-Reflection-Li-Tan/3e358882af7a2e782fdb02c0ccf260f00728aff0">[5] https://www.semanticscholar.org/paper/Understanding-and-Analyzing-Java-Reflection-Li-Tan/3e358882af7a2e782fdb02c0ccf260f00728aff0</a></p>
<p><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/paper/Taming-reflection%3A-Aiding-static-analysis-in-the-of-Bodden-Sewe/1753d3e97fdbe7799b9625cb873b77eef506a608">[6] https://www.semanticscholar.org/paper/Taming-reflection%3A-Aiding-static-analysis-in-the-of-Bodden-Sewe/1753d3e97fdbe7799b9625cb873b77eef506a608</a></p>
<p><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/paper/Identifying-Java-calls-in-native-code-via-binary-Fourtounis-Triantafyllou/8da9ef89f6b211193e2376a7d289f6b087f7cb5c">[7] https://www.semanticscholar.org/paper/Identifying-Java-calls-in-native-code-via-binary-Fourtounis-Triantafyllou/8da9ef89f6b211193e2376a7d289f6b087f7cb5c</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/02/soundiness/" data-id="cl1q2wlhy001647w59bfo8mjv" data-title="soundiness" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/03/17/static-sum/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          静态分析之殇
        
      </div>
    </a>
  
  
    <a href="/2021/01/15/security/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">安全性分析</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/paper/" rel="tag">paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pl/" rel="tag">pl</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/paper/" style="font-size: 15px;">paper</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/pl/" style="font-size: 20px;">pl</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/05/test-math/">test_math</a>
          </li>
        
          <li>
            <a href="/2022/04/06/taint-2/">PHP污点分析</a>
          </li>
        
          <li>
            <a href="/2022/03/31/nlp-1/">NLP入门(一)</a>
          </li>
        
          <li>
            <a href="/2022/02/24/web/">Web应用系中注入类漏洞调研</a>
          </li>
        
          <li>
            <a href="/2022/02/18/data-mining/">data_mining</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 iohex<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  </div>
</body>
</html>